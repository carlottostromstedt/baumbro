{% extends "base.html" %}

{% block content %}

{% for baum in baeume %}

<h1>{{ baum.name }}</h1>
<h3>Hello {{request.args.get('xlongitude')}}</h3>
<h3>Hello {{request.args.get('xlatitude')}}</h3>
<h3>Hello {{request.args.get('markers')}}</h3>

<h3>{{ baum.latitude }}</h3>
<h3>{{ baum.longitude }}</h3>
<h3>{{ baum.kategorie }}</h3>
<h3>{{ baum.baumnamedeu }}</h3>

{% endfor %}

<div id="map" style="height: 600px;"></div>
<script src="{{ url_for('static', filename='js/universal.js') }}">
</script>

<script>
// Get latitude and longitude parameters from the URL
var urlParams = new URLSearchParams(window.location.search);
var latitude = parseFloat(urlParams.get('latitude'));
var longitude = parseFloat(urlParams.get('longitude'));

// Check if latitude and longitude are valid
if (isNaN(latitude) || isNaN(longitude)) {
    console.error('Latitude or longitude is invalid');
} else {
    console.log('Latitude:', latitude);
    console.log('Longitude:', longitude);

    // Assuming `map` is your Leaflet map object
    L.marker([latitude, longitude]).addTo(map)
        .bindPopup("Popup content here")
        .openPopup();
}
</script>


<script>
    // Iterate over the baeume array
    {% for baum in baeume %}
        // Get latitude and longitude parameters from the `baum` object
        var latitude = {{ baum.latitude }};
        var longitude = {{ baum.longitude }};
        
        // Check if latitude and longitude are valid
        if (!isNaN(latitude) && !isNaN(longitude)) {
            console.log('Latitude:', latitude);
            console.log('Longitude:', longitude);
            
            // Create a marker with popup
            var marker = L.marker([latitude, longitude], { title: "{{ baum.baumnamedeu }}", riseOnHover: true, interactive: true }).addTo(map);
            marker.bindPopup("<b>{{ baum.baumnamedeu }}</b><br>{{ baum.baumnummer }}");
            
            // Create a closure to capture the current marker
            (function(marker) {
                // Add click event listener to the marker
                marker.on('click', function(e) {
                    marker.openPopup();
                });
            })(marker);
        } else {
            console.error('Latitude or longitude is invalid');
        }
    {% endfor %}
</script>


{% endblock %}